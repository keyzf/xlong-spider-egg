{% extends "./common/layout.html" %}

{% block head %}

    <link rel="stylesheet" href="/public/home/css/index.css"/>

{% endblock %}

{% block content %}
    
    <div class="container">
        <div class="index-content">
            <div class="form">
                <div class="form-inline">
                    <label class="form-inline__label">网址：</label><input id="inputImg" class="input form-inline__input" style="width:80%;" type="text" value="" placeholder="请输入网址"/>
                </div>
                <div class="form-inline">
                    <label class="form-inline__label"></label>
                    <button class="button primary" onclick="getData(1)">获取截图</button>
                    <button class="button defult ml-sm" onclick="reset($('#inputImg'))">重置</button>
                </div>
            </div>            
        </div>
        <div class="index-content">
            <div class="form">
                <div class="form-inline">
                    <label class="form-inline__label">网址：</label><input id="inputPdf" class="input form-inline__input" style="width:80%;" type="text" value="" placeholder="请输入网址"/>
                </div>
                <div class="form-inline">
                    <label class="form-inline__label"></label>
                    <button class="button primary" onclick="getData(2)">获取PDF</button>
                    <button class="button defult ml-sm" onclick="reset($('#inputPdf'))">重置</button>
                </div>
            </div>
        </div>
        <div class="index-content">
            <div class="form">
                <!-- <div class="hint">节点数据根据 https://www.17k.com/book/3034368.html 为例分析</div> -->
                <div class="form-inline">
                    <label class="form-inline__label">网址：</label><input id="inputInfo" class="input form-inline__input" style="width:80%;" type="text" value="" placeholder="请输入网址"/>
                </div>
                <!-- <div class="hint" style="margin-left:10px;">爬取配置：</div>
                <div class="form-inline">
                    <label class="form-inline__label">章节节点：</label><input class="input form-inline__input" style="width:80%;" type="text" value="" placeholder="例如：.list > li a"/>
                </div>
                <div class="form-inline">
                    <label class="form-inline__label">内容节点：</label><input class="input form-inline__input" style="width:80%;" type="text" value="" placeholder="例如：.content p"/>
                </div> -->
                <div class="form-inline">
                    <label class="form-inline__label"></label>
                    <button class="button primary" onclick="getData(3)">获取数据</button>
                    <button class="button defult ml-sm" onclick="reset($('#inputInfo'))">重置</button>
                </div>
            </div>
            <div id="dataContent" class="data">
                <h4 class="data-hint">获取到的数据如下：</h4>
                <ul id="list" class="section-list">
                </ul>
            </div>
        </div>
    </div>
{% endblock %}
{% block script %}

    <script type="text/javascript">
        var $inputImg = $('#inputImg');
        var $inputPdf = $('#inputPdf');
        var $inputInfo = $('#inputInfo');

        var $list = $('#list');
        var $data = $('#dataContent');

        function getData(type){
            $list.empty();
            $data.hide();

            var value = '';
            switch(type){
                case 1: value = $inputImg.val(); break;
                case 2: value = $inputPdf.val(); break;
                case 3: value = $inputInfo.val(); break;
                default: console.log('获取数据传参类型不正确'); return false;
            }

            if(value && value !== ''){
                console.log('开始获取数据');
                showLoading('正在获取数据，请稍后...');

                $.ajax({
                    type:'GET',
                    url: `/spider/${type}?web=${value}`,
                    success: function(res) {
                       console.log(res);

                        if(res.code == 200){
                            if(res.data){
                                if(type === 3){
                                    if(res.data.length > 0){
                                        $data.show();
                                        // var content = '';                                        
                                        // res.data.forEach((el, index) => {
                                        //     content += `<li><a href="${el.url}">${index + 1}. ${el.title}</a></li>`;
                                        // });
                                        // $list.append(content);
                                        $list.append(res.data);
                                        showAlertMsg('success','数据获取成功');
                                    }
                                    else{
                                        showAlertMsg('warning','数据为空，请检查获取的数据网址是否正确');
                                    }
                                }
                                else{
                                    window.open(res.data);
                                    showAlertMsg('success','数据获取成功');
                                }

                                hideLoading();
                                
                                console.log('数据获取结束');
                            }                            
                        }
                        else{
                            hideLoading();
                            showAlertMsg('error', res.msg);
                        }
                    },
                    error: function(err){
                       console.log('数据获取出错:', err);
                    }
                });
            }
            else{
                alert('请输入网址');
            }
        }

        function reset(e){
            e.val('');
        }
    </script>

{% endblock %}